@using Sakura.AspNetCore.Localization

@model IPagedList<App>
@inject IDynamicViewLocalizer ViewLocalizer
@{
	ViewBag.Title = "我的应用";
}

<div class="alert alert-info">该列表中列出了所有由你创建的应用信息。</div>

@if (Model.Any())
{
	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th>名称</th>
				<th>状态</th>
				<th>创建日期</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var i in Model)
			{
				<tr data-id="@i.Id" data-name="@i.DisplayName">
					<th><a asp-controller="App" asp-action="Detail" asp-route-id="@i.Id">@i.DisplayName</a></th>
					<td>
						@switch (i.State)
						{
							case AppState.Normal:
								<strong class="text-success">已审核</strong>
								break;
							case AppState.TestOnly:
								<strong class="text-warning">未审核</strong>
								break;
							case AppState.Trusted:
								<strong class="text-primary">受信任</strong>
								break;
							case AppState.Revoked:
								<strong class="text-danger">已吊销</strong>
								break;
							default:
								<strong class="text-muted">未知</strong>
								break;
						}
					</td>
					<td>@i.CreateTime.ToString("G", CultureInfo.CurrentUICulture)</td>
					<td>
						<div class="btn-group btn-group-sm">
							<a asp-controller="App" asp-action="Edit" asp-route-id="@i.Id" class="btn btn-secondary">编辑</a>
							<button type="button" class="btn btn-danger" onclick="deleteApp(this);">删除</button>
						</div>
					</td>
				</tr>
			}
		</tbody>
	</table>

	<pager />
}
else
{
	<p class="text-muted text-center">你还没有注册任何应用。<a asp-controller="App" asp-action="Create">点击这里</a> 立即注册你的第一个应用吧！</p>
}

<form asp-controller="App" asp-action="Delete" method="post" asp-antiforgery="true" data-ajax="true" data-ajax-failure="handleAjaxFailure(xhr, '#delete-app-error')">
	<input type="hidden" id="delete-app-id" name="id" />
	<div class="modal fade" id="delete-app-modal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">删除应用</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="关闭">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>你确定要删除应用 <strong id="delete-app-name"></strong> 吗？这个操作无法撤销。删除应用后，该应用将无法使用 CC98 账户登录。如果你确定要执行删除操作，请单击对话框的<q>确认删除</q>按钮。
					</p>
				</div>
				<div class="modal-footer">
					<p class="text-danger" id="delete-app-error"></p>
					<button type="submit" class="btn btn-danger">确认删除</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
				</div>
			</div>
		</div>
	</div>
</form>

@section Scripts{

	<script>

		function deleteApp(ele) {

			var row = $(ele).closest('tr');

			var id = $(row).data('id');
			var name = $(row).data('name');

			$('#delete-app-id').val(id);
			$('#delete-app-name').text(name);

			$('#delete-app-modal').modal();
		}

	</script>

}